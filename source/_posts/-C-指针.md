title: C/C++指针
author: 田亮
abbrlink: da05
tags:
  - C
categories:
  - C
date: 2019-04-26 14:53:00
---
## 指针是什么
如果在程序里定义了一个变量,在对程序进行编译时,系统就会给这个变量分配内存单元.
编译系统根据定义的变量类型,分配一定的内存空间.在内存区,每一个字节都有一个编号,这就是 地址
由于通过地址能找到所需要的变量单元,可以说**地址指向该变量单元**将地址形象化地成为**指针**意思是通过他能找到以它为地址的内存单元
**一个变量的地址称之为该变量的"指针".如果有一个变量专门用来存放另一个变量的地址,它被称之为"指针变量"**
**指针变量就是地址变量,用来存放地址.指针变量的值是地址(指针)**
<font color="#FF8000">请区分好:指针是一个地址,而指针变量是存放地址的变量</font>
<!--more-->
 ## 指针变量
 &取地址运算符
 &a 变量a的地址
 \* 指针运算符
 **指针变量 = 类型名 *指针变量名**
 存放指针的变量叫做指针变量,它用来指向另一个对象(变量,数组,函数等)
 在定义指针变量时,必须指定基类型.*为什么要指定基类型呢?主要原因是不同类型的数据在内存中占用不同字节*
 ```C
 #include <stdio.h>
int main()
{
	int a=150;
	int *c; //定义指向整型数据的指针变量
	c=&a;//把变量a的地址赋值给指针c
	printf("整形变量a的值为:%d\n",a);
	printf("指针的值为:%d\n",*c);
}
```
> 根据上面代码: & 是取地址运算符  &a 是变量a的地址
\* 是指针运算符 \*c 代表指针变量 c 指向的对象

一个变量的指针含义包括2个方面:
以存储单元编号表示的地址
它指向的存储单元的数据类型
如何表示指针的类型: 指向整型数据的指针类型为 "int *" 读作:指向int的指针或者简称"int指针"
**指针变量中只能存放地址,不要试图将一个整数赋值给一个指针变量**
## 指针变量作为函数参数
函数的参数不仅可以为整型,浮点等.还可以是指针类型.它的作用是将一个变量的地址传送到另一个函数中
```c
#include <stdio.h>
int main()
{
	void s(int *s,int *s2); //对函数进行声明 
	int *a,*b; //定义指针
	int c,d; //定义整型
	printf("请输入2个数字:\n");
	scanf("%d,%d",&c,&d);//输入2个整数
	a=&c;//指针指向c
	b=&d;
	s(a,b); //调用函数
	printf("%d  %d\n",c,d);//因为ab指向cd,所以ab改变cd就改变  输出c和d
}
void s(int *s,int *s2){
	int max;
	if(*s < *s2){
		max=*s;
		*s = *s2;
		*s2 = max;
	}
}
```
为了使在函数中改变了的变量值能被主函数(main)所用,用指针变量作为参数,在函数执行过程中使指针变量所指向的变量值发生变化,在函数调用结束后,这些值的变化依然保留下来.这样就实现了通过调用函数使变量的值发生变化
如果想通过调用函数得到N和想要改变的值:
1. 在主函数中设N个变量,并且用N个指针指向它们
2. 设计一个函数,有N个指针形参,在这个函数中改变这N个形参的值
3. 在主调函数中调用这个函数,在调用时将这N个指针变量做实参,将他们的地址传给该函数的形参
4. 在执行该函数的过程中,通过形参指针变量改变他们所指向的N个变量的值
5. 主调函数中就可以使用这些改变了值的变量

**不能企图通过改变指针形参的值而使指针实参的值改变**

## 通过指针引用数组元素
一个变量有地址,一个数组元素包含若干元素,每个数组元素都在内存中占用存储单元,并且他们都有相对应的地址
引用数组元素可以使用下标法(a[3]>也可以使用指针法,即通过指向数组元素的指针找到所需要的元素.使用指针法能使目标程序质量高(运行快,占用内存少)
> p=&a[0]; //p的值是数组a[0]的地址
 p=a; //p的值是数组a首元素 的地址 即:a[0]的地址
 它两个等价

**数组名不代表整个数组,只代表数组首元素的地址**
**所谓数组元素的指针就是数组元素的地址**
```C
#include <stdio.h>
int main(int argc, char const *argv[])
{
	int a[5]={1,2,3,4,5}; //定义一个数组
	int *b; //定义一个指针
	b=&a[0]; //将数组的第一位数的位置给指针变量b
	printf("%d  %d\n",b,b+1); //输出数组第一位的地址和第二位的地址
	return 0;
}
```
引用一个数组元素,可以使用下标法和指针法
```C
#include <stdio.h>
int main()
{
	int a[5]={1,2,3,4,5}; 
	int i,*b,*c;
	b=&a[0];
	c=a;//同上面写法,一样的.上面看到比较舒服
	for (i = 0; i < 5; ++i)
	{
		printf("%d  ",*(b+i)); //用指针指向当前的数组元素
		printf("%d  ",*(c+i)); //用指针指向当前的数组元素
		printf("%d  ",*(b++));//也可以
	}
}
```
实参数组名代表一个固定的地址,或者说是指针常量.但形参数组名并不是一个固定的地址,而是按指针变量处理


## 通过指针引用多维数组
指针变量可以引用一维数组和多维数组中的元素.但是在概念上多维数组比一维数组的使用方法上要复杂一些
<font color="red">注意:a+1是二维数组a中序号为1的行的首地址,而*(a+1)并不是a+1单元的值,因为a+1并不是一个变量的存储单元.
*(a+1)就是a[1],而a[1]是一维数组名,所以也是地址,它指向a[1][0]
*(a+1)和a[1]都是二维数组中地址的不同表现方式
</font>
```c
#include <stdio.h>
int main()
{
	int a[4][6]={1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6};
	printf("%d   %d\n",a,*a ); //这两个指向同一个地址
	printf("%d   %d\n",a+1,*a+1 ); //地址不同
	printf("%d   %d\n",a+1,*(a+1) ); //这两个指向同一个地址
	printf("%d   %d\n",a[2],*(a+2) ); //这两个指向同一个地址
	printf("%d   %d\n",&a[2],a+2 ); //这两个指向同一个地址
	printf("%d   %d\n",a[2][2],*(a[2]+2) ); //这两个指向同一个地址

}
```
**输出二维数组任意行和列的值**
```c
#include <stdio.h>
int main()
{
	//使用指针输出任意一个二维数组的值
	int a[3][4]={1,2,3,4,11,22,33,44,111,222,333,444};
	int (*s)[4],i,k;
	s=a;
	printf("请输入数组坐标:\n");
	scanf("%d,%d",&i,&k);
	printf("%d\n",*(*(s+i)+k));
}
```
或者
```C
#include <stdio.h>
int main()
{
	int a[2][3]={{1,2,3},{4,5,6}};
	int *b,i,k;
	b=&a[0][0];
	for (i = 0; i < 2; ++i)
	{
		for (k = 0; k < 3; ++k)
		{
			printf("%d",*(*(a+i)+k));
		}
	printf("\n");
	}
	}
```
## 指向数组元素的指针变量
二维数组的元素在内存中是按行顺序存放的,即存完序号为0的行中的全部元素后,接着存放下一行中的全部元素.因此可以使用一个指向元素的指针变量来依次指向各元素
```C
#include <stdio.h>
int main()
{
	int a[3][5]={{1,2,3,4,5},{1,2,3,4,5},{1,2,3,4,5}};
	int *b,i;
	for(b=a[0];b<a[0]+15;b++){
		if((b-a[0])%5==0){
			printf("\n");
		}
		printf("%4d",*b);
	}
}
```
## 通过指针引用字符串
在c程序中,字符串是存放在字符数组中的,有两种方式可以获取字符串
**用字符串数组存放一个字符串**
可以通过数组名和下标引用字符串中的一个字符,也可以数组名和格式声明"%s"来输出字符串
```c
#include <stdio.h>
int main()
{
	char str[]="我喜欢你!,i love you!";
	char *str2="我喜欢你!,i love you!"; //使用指针输出
	printf("%s\n", str); //使用 %s 输出整个字符串 
	printf("%c\n", str[10]);//使用 %c 输出数组  对中文有点不兼容
	printf("%s\n", str2);
}
```
**用字符串指针变量输出字符串**
在c语言中,只有字符变量没有字符串变量
```C
#include <stdio.h>
int main()
{
	char *s="haha";
	printf("%s\n",s );//打印haha    如果不是指针的话会报错
}
```

## 指向函数的指针
如果在程序中,定义了一个函数,在编译时编译系统为函数代码分配一段存储空间,这段存储空间的起始地址称为这个函数的指针
如果想调用一个函数,除了可以通过函数名进行调用之外,还可以通过指向函数的指针变量来调用函数
```c
#include <stdio.h>
int main()
{
	int c(int,int); //变量名可以不写,只要系统知道有这个变量即可
	int a=20,aa=40;
	int (*b)(int,int);//定义指向函数的指针变量b
	b=c;//使b指向c
	int max = b(a,aa);
	printf("%d\n",max);
}
int c(int x,int y){
	int max = x>y?x:y;
	return max;
}
```
### 怎样定义和使用指向函数的指针变量
**类型名 (*指针变量名)(函数参数表列);**
int (*a)(int,int);
```C
#include <stdio.h>
int main()
{
	int max(int,int); //变量名可以不写,只要系统知道有这个变量即可
	int min(int,int);
	int (*p)(int,int);
	int a,b,c,max2;
	printf("请输入2个数字:\n");
	scanf("%d,%d",a,b);
	printf("1最大,2最小:\n");
	scanf("%d",c);
	if(c==1){
		p=max; //不需要加括号
	}else{
		p=min;
	}
	max2 = (*p)(a,b);
	printf("%d\n",max);
}
int max(int x,int y){
	int max2=x>y?x:y;
	return max2;
}
int min(int x,int y){
	int max2=x<y?x:y;
	return max2;
}
```
## 指针数组和多重指针
一个数组,若其元素均为指针类型数据,称之为指针数组.也就是说每一个元素里都存放一个地址,相当于指针变量
int \*a[4] ***指向一维数组的指针变量***
什么情况下用到指针数组呢?指针数组比较适合用来指向若干个字符串,使字符串操作更加灵活
```C
#include <stdio.h>
int main(){
	void pai(char *b[],int n);
	char *a[]={"a","b","c","d","e"};
	int len = sizeof(a) /sizeof(a[0]-1),k;
	printf("抓换之前为:\n");
	for (k = 0; k < len; ++k)
	{
		printf("%s,  ",a[k]);
	}
	pai(a,len);
	printf("抓换之后为:\n");
	for (k = 0; k < len; ++k)
	{
		printf("%s,  ",a[k]);
	}
}
void pai(char *b[],int n){
	int i,k,y;
	char *c;
	for(i = 0; i < n; ++i){
		y=i;
		for(k = 0; k < n; ++k){
			if(strcmp(b[y],b[k])>0){
				y=k;
			}
			if(y!=i){
				c=b[i];
				b[i]=b[y];
				b[y]=c;
			}
		}
	}
}
```
### 指向指针数据的指针
```c
#include <stdio.h>
int main(){
	char *b[]={"233","2333","dsadsa"};
	char **a;
	int i;
	for (i = 0; i < 3; ++i)
	{
		a=(b+i);
		printf("%s\n",*a);
	}

}
```
## 内存的动态分配
c语言中有全局变量和局部变量,全局变量是分配在内存中的静态存储区的,非静态局部变量(包括形参)是分配在内存中的动态区域的,这个存储区域称之为"栈"的区域
在c语言中,还允许建立内存动态分配区域,以存放一些临时使用的数据,这些数据不必在程序的声明部分定义,也不必等到函数结束时释放,而是**需要时随时开辟,不需要时随时释放**这些数据存放在一个特别的自由存储区域.称之为"堆".由于未在声明部分定义它们为变量或数组,因此不能通过变量名或数组名去引用这些数据.只能通过指针来引用
### 怎样建立内存的动态分配
对内存的动态分配是通过系统的函数库来实现的,主要有:malloc,calloc,free,realloc

malloc:在内存的动态存储区中分配一个连续的空间<br><font color="#ACA4A4">malloc(100);//开辟一个100字节的临时分配域,函数值为第一个字节的地址</font><br>
calloc:在内存的动态存储区域分配n个连续空间,这个空间一般比较大,用来保存数组<br><font color="#ACA4A4">p=calloc(50,4);//开辟一个50×4个字节的临时分配域,把起始地址赋值给指针变量p</font><br>
free:释放指针变量所指向的动态空间,使这部分空间可以被其它变量使用<br><font color="#ACA4A4">free(p);//释放指针变量p所指向的已分配的动态空间</font><br>
realloc:如果使用malloc和calloc函数获得了动态空间,想改变其大小,使用realloc函数重新分配,如果重新分配不成功返回NULL.<br><font color="#ACA4A4">realloc(p,50);//将p所指向的已分配的动态空间改为50字节</font><br>

```C
#include <stdio.h>
#include <stdlib.h>
int main(){
	void c(int * );
	int *p,i;
	p=(int *)malloc(5*sizeof(int));//开辟一个动态内存,将地址转换成int * 类型,然后放在p中
	for(i=0;i<5;i++){
		printf("请输入第%d个学生的成绩\n",i+1);
		scanf("%d",p+i);
	}
	c(p);
}
void c(int * p2){
	int i;
	printf("成绩不及格的有:\n");
	for(i=0;i<5;i++){
		if(p2[i]<60){
			printf("%d\n",p2[i]);
		}
	}
}
```
## 总结
指针就是地址.变量的指针就是变量的地址,指针的变量就是地址变量
区别指针和指针变量.指针就是地址.指针变量是用来存放地址的变量
指针变量可以有空值,该指针变量不指向任何变量


|变量定义|类型表示|含义|
|:-:|:-:|:-:|
|int i|int|定义整形变量i
|int \*p|int \*|定义p为指向整数类型数据的指针变量
|int a[5]|int[5]|定义整形数组,它有5个元素
|int \*p[4]|int * [4]|定义指针数组,它由4个指向整型数据的指针元素构成
|int(\*p)[4]|int(\*)[4]|p为指向包含4个元素的一维数组的指针变量
|int f()|int ()|f为返回整型数值的函数
|int \*p()|int\*()|p为返回一个指针的函数,该指针指向整型数据
|int(\*p)()|int(\*)()|p为指向函数的指针,该函数返回一个整型值
|int \*\*p|int \*\*|p是一个指针变量,它指向一个指向函数类型数据的指针变量
|void \*p|void \*|p是一个指针变量,基类型为void(空类型),不指向具体的对象
