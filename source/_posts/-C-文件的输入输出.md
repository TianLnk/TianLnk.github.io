title: C/C++文件的输入输出
author: 田亮
abbrlink: '8898'
tags:
  - C
categories:
  - C
date: 2019-04-30 21:27:00
---
在程序设计中,主要用到两种文件:
1. 程序文件 包括源文件,可执行文件等.
2. 数据文件 文件的内容不是可执行文件,而是为程序运行时提供读写数据

为了简化用户的操作,操作系统把所有的设备统一作为文件处理.从操作系统的角度看,每一个与主机连接的的输入输出设备都是被看做成一个文件.
文件是程序设计中的一个重要概念.所谓文件一般指**存储在外部介质上数据的集合**
输入输出数据是数据传送的过程,数据如同流水一样从这边到那边.因此常常将输入输入成为**流,即数据流**
<!--more-->
## 文件的分类
根据数据的组织形式,数据文件可以分为**ASCII(美国信息交换标准代码)和二进制文件**
数据在内存中是以二进制形式存储的,如果不加以转换地输出到外存,就是二进制文件.可以认为它就是存储在内存数据的映像,所以也称之为**映像文件(image file)**　如果需要以ASCII格式进行存储需要二次转换,ASCII文件又称文本文件（text file），每一个字节放一个字符的ASCII代码
字符一律以ASCII格式进行存储，数值类型可以为二进制类型也可以为ASCII类型．相对于ASCII二进制占用空间更少
## 文件缓冲区
C标准采用**缓冲文件系统**处理数据文件,所谓缓冲文件系统是指系统自动地在内存区为程序中的每一个正在使用的文件开辟一个**文件缓冲区**
**从内存向磁盘输出数据必须先送到内存中的缓存区,缓存区满了以后再写入到磁盘**
## 文件指针类型
缓冲文件系统中,最关键的概念是**文件类型指针**简称**文件指针**
每个被使用的文件都在内存中开辟一个相对应的文件信息区,用来存放文件的相关信息(文件名,大小,位置等).这些信息保存在一个结构体变量中.
该结构体由系统自动生成,名字为**FILE**
```C
FILE * f;
f = fopen("hanshu.c","r");
```
## 打开与关闭文件
### 使用fopen函数来打开数据文件
**fopen("文件名","文件使用方式")**
forpen("a.txt","r");

|文件使用方式|含义|如果文件不存在|
|:-:|:-:|:-:|
|r(只读)|为了输入数据,打开一个已存在的文本文件|出错
|w(只写)|为了输出数据,打开一个文本文件|建立新文件
|a(追加)|向文本文件尾添加数据|出错
|rb(只读)|为了输入数据,打开一个二进制文件|出错
|wb(只写)|为了输出数据,打开一个二进制文件|建立新文件
|ab(追加)|向二进制文件尾添加数据|出错
|r+(读写)|为了读和写,打开一个文本文件|出错
|w+(读写)|为了读和写,建立一个新的文本文件|建立新文件
|...+()读写|...|...

用r方式打开的文件只能用于向计算机输入而不能输出.并且该文件必须存在并且有数据
用w方式打开的文件只能向该文件写入数据而不能向计算机输入,如果文件不存在新建文件
```C
# include <stdio.h>
int main(){
FILE * f;
if((f=fopen("hanshu.c","r"))==NULL){ //如果为空说明出错或者文件为空
	printf("打开出错\n");
	exit(0);//关闭所有文件并且终止正在运行的程序
	}
}
```
### 使用fclose函数关闭打开的文件
任何时候,文件有打开就要有关闭,以防止再次被误用和占用内存
关闭就是撤销文件信息区和文件缓存区,使文件的指针变量不再指向该文件
fclose(文件指针);
fclose(f);
**如果不关闭文件将会造成文件丢失**因为在向文件写入数据时,先将数据输出到缓存区,待缓存区存满后写入到文件,如果当数据未充满缓存区而程序结束运行则可能造成缓存区中的数据丢失.要使用fclose函数关闭文件,先把缓存区中的数据输出到磁盘文件中,然后才撤销文件信息区.
fclose函数也有一个返回值.当成功执行了关闭文件操作返回0,否则返回EOF(-1)
## 按顺序读写文件
注意:在c盘下可能无权限,但是也不会提示
```C
# include <stdio.h>
# include <stdlib.h>
int main(){
	FILE * fp;//指针变量fp指向文件函数FILE
	char ch,file2[10];//定义2个变量
	printf("请输入文件名:\n");
	scanf("%s",file2);
	if((fp=fopen(file2,"w"))==NULL){//判断是否有这个文件
		printf("打开错误,可能没有此文件\n");
		exit(0);
	}
	ch=getchar();//char类型输入
	printf("请输入要输入的内容:\n");
	ch=getchar();
	while(ch!='#'){//输入#退出循环
		fputc(ch,fp);//写入文件到硬盘
		putchar(ch);//打印输出的内容
		ch=getchar();
	}
	fclose(fp);//关闭打开的文件
	putchar(10);//打印换行
}
```
## 复制文件
```C
# include <stdlib.h>
# include <stdio.h>
int main(){
FILE *in ,*out;
char c;
if((in=fopen("123.txt","r"))==NULL){
	printf("无法打开文件\n");
	exit(0);
	}
if((out=fopen("456.txt","w"))==NULL){
	printf("无此文件\n");
	exit(0);
}
while(!feof(in)){
	c=fgetc(in);
	fputc(c,out);
}
fclose(in);
fclose(out);
}
```
**读写一个字符的函数**

|函数名|功能|返回值
|:-:|:-:|:-:|
|fgetc|从指向的文件读入一个字符|成功,带回所读取的字符,否则返回EOF即-1
|fputc|把字符写到文件指针变量所指向的文件中|成功,带回所读取的字符,否则返回EOF即-1

## 向文件读写一个字符串
|函数名|调用形式|功能|返回值
|:-:|:-:|:-:|:-:|
|fgets|fgets(str,n,f)|从f指向的文件读入一个长度为n-1的字符串存放到字符数组str中|成功返回str,失败返回null
|fputs|fputs(str,fp)|把str指向的字符串写到文件指针变量fp所指向的文件中|成功返回0,失败返回非0

 











